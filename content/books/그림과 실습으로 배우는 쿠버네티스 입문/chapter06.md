+++
title = "Chapter 06. 쿠버네티스 리소스 만들고 망가뜨리기"
date = "2025-12-01"
weight = 6
+++




# 6.1 pod의 라이프사이클 알기

```
                        Pod Lifecycle

    +-----------------------------------------------------------+
    |                                                           |
    |   Pending ──────> Running ──────> Succeeded               |
    |      │               │                                    |
    |      │               │                                    |
    |      │               ▼                                    |
    |      │            Failed                                  |
    |      │                                                    |
    |      └──────────> Unknown                                 |
    |                                                           |
    +-----------------------------------------------------------+

    Phase 설명:
    ┌─────────────┬────────────────────────────────────────────┐
    │ Pending     │ Pod이 승인되었지만 컨테이너가 아직 생성 안됨         │
    ├─────────────┼────────────────────────────────────────────┤
    │ Running     │ Pod이 노드에 바인딩, 모든 컨테이너 생성됨           │
    ├─────────────┼────────────────────────────────────────────┤
    │ Succeeded   │ 모든 컨테이너가 성공적으로 종료됨                  │
    ├─────────────┼────────────────────────────────────────────┤
    │ Failed      │ 모든 컨테이너 종료, 하나 이상 실패                 │
    ├─────────────┼────────────────────────────────────────────┤
    │ Unknown     │ Pod 상태를 알 수 없음 (노드 통신 오류)            │
    └─────────────┴────────────────────────────────────────────┘
```

### Container States

```
    ┌─────────────────────────────────────────────────────────┐
    │                    Container States                      │
    │                                                          │
    │    Waiting ──────> Running ──────> Terminated            │
    │       │               │                │                 │
    │       │               │                │                 │
    │       └───────────────┴────────────────┘                 │
    │                   (재시작 시)                              │
    └─────────────────────────────────────────────────────────┘
```

### Pod Phase vs STATUS 컬럼

**Pod Phase (라이프사이클)**는 5가지만 존재합니다:
- Pending, Running, Succeeded, Failed, Unknown

**STATUS 컬럼** (`kubectl get pods`)은 Phase + Container 상태 + 조건들을 조합한 **요약 정보**입니다. STATUS는 컨테이너의 `state`와 `reason` 필드에서 가져오며, 실제로 수십 가지가 존재합니다.

```
    ┌────────────────────┬─────────────┬──────────────────────────────────────┐
    │ STATUS 표시         │ 실제 Phase  │ 의미                                   │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ Pending            │ Pending     │ 스케줄링 대기 중                         │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ ContainerCreating  │ Pending     │ 컨테이너 생성 중                         │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ Init:0/1           │ Pending     │ Init 컨테이너 실행 중                    │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ PodInitializing    │ Pending     │ Init 컨테이너 완료, 메인 컨테이너 시작       │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ ImagePullBackOff   │ Pending     │ 이미지 풀 실패 (재시도 대기)               │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ ErrImagePull       │ Pending     │ 이미지 풀 실패 (즉시)                    │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ Running            │ Running     │ 정상 실행 중                            │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ CrashLoopBackOff   │ Running     │ 컨테이너 반복 크래시 (재시작 대기)           │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ Error              │ Running     │ 컨테이너 오류로 종료                      │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ OOMKilled          │ Running     │ 메모리 부족으로 강제 종료                  │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ Terminating        │ Running     │ 삭제 진행 중                            │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ Completed          │ Succeeded   │ 정상 종료 (Job 등)                      │
    ├────────────────────┼─────────────┼──────────────────────────────────────┤
    │ Unknown            │ Unknown     │ 노드와 통신 불가                         │
    └────────────────────┴─────────────┴──────────────────────────────────────┘
```

> **참고**: `ErrImagePull`과 `ImagePullBackOff`의 차이
> - `ErrImagePull`: 이미지 풀 첫 실패 시
> - `ImagePullBackOff`: 재시도 간격을 두고 대기 중 (exponential backoff)

```bash
# Phase 확인
kubectl get pod <name> -o jsonpath='{.status.phase}'

# 전체 상태 확인
kubectl describe pod <name>
```


# 6.2 Pod의 다중화를 위한 ReplicaSet과 Deployment
지금까지 Pod에 대해 학습하고 트러블 슈팅을 해봤습니다.
하지만, Pod만으로는 컨테이너 다중화가 불가능하기 때문에 실제 운영 환경에서는 권장하지 않습니다.
그래서 Deployment라는 리소스를 사용합니다.

## ReplicaSet

ReplicaSet은 지정된 수의 Pod를 복제하는 리소스이며, 복제본이 항상 실행되도록 보장합니다.

```
                            ReplicaSet
    ┌─────────────────────────────────────────────────────────┐
    │                                                         │
    │   replicas: 3                                           │
    │   selector: app=nginx                                   │
    │                                                         │
    │   ┌─────────┐    ┌─────────┐    ┌─────────┐             │
    │   │  Pod 1  │    │  Pod 2  │    │  Pod 3  │             │
    │   │  nginx  │    │  nginx  │    │  nginx  │             │
    │   └─────────┘    └─────────┘    └─────────┘             │
    │                                                         │
    │   Pod이 죽으면 자동으로 새 Pod 생성                           │
    │                                                         │
    └─────────────────────────────────────────────────────────┘
```

ReplicaSet 매니페스트

```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: httpserver
  labels:
    app: httpserver
spec:
  replicas: 3
  selector:
    matchLabels:
      app: httpserver
  template:
    metadata:
      labels:
        app: httpserver
    spec:
      containers:
        - name: nginx
          image: nginx:1.25.3

        

```

## Deployment

Deployment는 ReplicaSet을 관리하며, 롤링 업데이트와 롤백 기능을 제공합니다.

```
                              Deployment
    ┌───────────────────────────────────────────────────────────────┐
    │                                                               │
    │   strategy: RollingUpdate                                     │
    │   replicas: 3                                                 │
    │                                                               │
    │   ┌─────────────────────────────────────────────────────┐     │
    │   │                   ReplicaSet                        │     │
    │   │                                                     │     │
    │   │    ┌─────────┐   ┌─────────┐   ┌─────────┐          │     │
    │   │    │  Pod 1  │   │  Pod 2  │   │  Pod 3  │          │     │
    │   │    │  v1.0   │   │  v1.0   │   │  v1.0   │          │     │
    │   │    └─────────┘   └─────────┘   └─────────┘          │     │
    │   │                                                     │     │
    │   └─────────────────────────────────────────────────────┘     │
    │                                                               │
    └───────────────────────────────────────────────────────────────┘

                         Rolling Update 과정
    ┌───────────────────────────────────────────────────────────────┐
    │                                                               │
    │   v1.0 → v2.0 업데이트 시                                        │
    │                                                               │
    │   1. 새 ReplicaSet 생성 (v2.0)                                  │
    │   2. 새 Pod 하나씩 생성                                          │
    │   3. 기존 Pod 하나씩 종료                                         │
    │   4. 모든 Pod이 v2.0이 될 때까지 반복                              │
    │                                                               │
    │   ReplicaSet (old)          ReplicaSet (new)                  │
    │   ┌─────────────────┐       ┌─────────────────┐               │
    │   │ Pod Pod Pod     │   →   │ Pod Pod Pod     │               │
    │   │ v1.0 v1.0 v1.0  │       │ v2.0 v2.0 v2.0  │               │
    │   └─────────────────┘       └─────────────────┘               │
    │                                                               │
    └───────────────────────────────────────────────────────────────┘
```

### Deployment vs ReplicaSet

```
    ┌──────────────┬──────────────────────────────────────────────┐
    │ 기능          │ ReplicaSet         │ Deployment              │
    ├──────────────┼────────────────────┼─────────────────────────┤
    │ Pod 복제      │ ✅                  │ ✅ (ReplicaSet 통해)     │
    ├──────────────┼────────────────────┼─────────────────────────┤
    │ 자동 복구      │ ✅                  │ ✅                      │
    ├──────────────┼────────────────────┼─────────────────────────┤
    │ 롤링 업데이트   │ ❌                  │ ✅                      │
    ├──────────────┼────────────────────┼─────────────────────────┤
    │ 롤백          │ ❌                  │ ✅                      │
    ├──────────────┼────────────────────┼─────────────────────────┤
    │ 버전 히스토리   │ ❌                  │ ✅                      │
    └──────────────┴────────────────────┴─────────────────────────┘
```

> **실무에서는 ReplicaSet을 직접 사용하지 않고, Deployment를 통해 관리합니다.**

## 



